package servlet.back;

import java.util.Map;

import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpSession;

import messages.AdminMessage;
import pages.AdminPages;
import factories.ServiceFrontFactory;
import utils.AbstractServlet;
import utils.MD5Code;
import vo.Admin;


@SuppressWarnings("serial")
@WebServlet("/login/back/admin/AdminLoginServletFront/*")
public class AdminLoginServletBack extends AbstractServlet
{

	
	private Admin admin = new Admin();

	public Admin getAdmin()
	{
		return admin;
	}
	
	private String loginValidation = "admin.aid|admin.password";
	
	protected String login()
	{
		try
		{
			if (!super.checkCode())
			{
				// 返回登录页面 验证码错误
				return super.setMsgAndUrlInRequest(AdminMessage.codeError, AdminPages.loginPage);
			} else
			{// 验证码正确
				System.out.println("[debug] *** 后台管理员登陆成功:" + this.admin);
				this.admin.setPassword(new MD5Code().getMD5ofStr(this.admin.getPassword()));
				Map<String, Object> map = ServiceBackFactory.getIAdminServiceFrontInstance().login(admin);
				boolean flag = (boolean) map.get("flag");
				if (flag)
				{ 
					// 登录成功
					this.admin = (Admin) map.get("admin"); 
					
					HttpSession session = this.request.getSession(); 
					
					// 前台人事管理员
					super.request.getSession().setAttribute("faid", this.admin.getAid());
					session.setAttribute("fAdmin", this.admin);
					return AdminPages.frontAdminIndexJSP;
					
					
//					if (this.admin.getType().equals(AdminType.FRONT_ADMIN.ordinal()))
//					{
//						
//					} else if (this.admin.getType().equals(AdminType.BACK_ADMIN.ordinal()))
//					{
//						// 后台人事管理员
//						super.request.getSession().setAttribute("baid", this.admin.getAid());
//						session.setAttribute("bAdmin", this.admin);
//						return super.setMsgAndUrlInRequest("后台管理员登录成功", AdminPages.backAdminIndexJSP);
//					} else
//					{
//						throw new Exception(AdminMessage.illegalAdminType);
//					}
				} else
				{
					return super.setMsgAndUrlInRequest(AdminMessage.userNameOrPasswordError, AdminPages.loginPage);
				}

			}
		} catch (Exception e)
		{
			return super.setSystemError(e);
		}
	}
	
	@Override
	protected String getUploadFolder()
	{
		// TODO Auto-generated method stub
		return null;
	}

	@Override
	protected String getColumns()
	{
		// TODO Auto-generated method stub
		return null;
	}

	@Override
	protected String getColumn()
	{
		// TODO Auto-generated method stub
		return null;
	}

}
