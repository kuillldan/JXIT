package utils;

import java.lang.reflect.Field;
import java.lang.reflect.Method;
import java.text.SimpleDateFormat;

public class BeanOperator
{
	private Object rootObject;
	private String property;
	private Object value;

	private Object currentObject;
	private String lastFieldName;
	private Field lastField;

	public BeanOperator(Object rootObject, String property, Object value)
	{
		super();
		this.rootObject = rootObject;
		this.property = property;
		this.value = value;
	}

	private void handleString() throws Exception
	{
		this.currentObject = this.rootObject;
		String[] propertiesInArray = property.split("\\.");
		for (int i = 0; i < propertiesInArray.length - 1; i++)
		{
			Method getter = this.currentObject.getClass().getDeclaredMethod(propertiesInArray[i]);
			this.currentObject = getter.invoke(this.currentObject);
		}
		this.lastFieldName = propertiesInArray[propertiesInArray.length - 1];
		this.lastField = this.currentObject.getClass()
				.getDeclaredField(propertiesInArray[propertiesInArray.length - 1]);
	}

	private void setValue() throws Exception
	{
		if (this.value == null)
			return;

		String lastFieldTypeName = this.lastField.getType().getSimpleName();
		Method setter = this.currentObject.getClass().getDeclaredMethod(
				"set" + StringUtils.initCap(this.lastFieldName), this.lastField.getType());

		if (!lastFieldTypeName.contains("[]"))
		{
			String valueInString = this.value.toString();
			if (StringUtils.isEmpty(valueInString))
				return;

			if ("String".equalsIgnoreCase(lastFieldTypeName))
			{
				setter.invoke(this.currentObject, this.value);
			} else if ("Integer".equalsIgnoreCase(lastFieldTypeName) || "int".equalsIgnoreCase(lastFieldTypeName))
			{
				setter.invoke(this.currentObject, Integer.parseInt(valueInString));
			} else if ("Double".equalsIgnoreCase(lastFieldTypeName) || "double".equalsIgnoreCase(lastFieldTypeName))
			{
				setter.invoke(this.currentObject, Double.parseDouble(valueInString));
			} else if ("Date".equalsIgnoreCase(lastFieldTypeName))
			{
				if (valueInString.matches("\\d{4}-\\d{2}-\\d{2}"))
				{
					setter.invoke(this.currentObject, new SimpleDateFormat("yyyy-MM-dd").parse(valueInString));
				} else if (valueInString.matches("\\d{4}-\\d{2}-\\d{2} \\d{2}:\\d{2}:\\d{2}"))
				{
					setter.invoke(this.currentObject, new SimpleDateFormat("yyyy-MM-dd HH:mm:ss").parse(valueInString));
				} else if (valueInString.matches("\\d{4}-\\d{2}-\\d{2} \\d{2}:\\d{2}:\\d{2}\\.\\d{3}"))
				{
					setter.invoke(this.currentObject, new SimpleDateFormat("yyyy-MM-dd HH:mm:ss.SSS").parse(valueInString));
				}
			}
		} else
		{
		}
	}
}